# https://docs.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=azure-devops
parameters:
  ImageName: ""
  serviceDockerHub: "wallaskreaDockerHub"
  dockerfile: "$(Build.SourcesDirectory).Dockerfile)"
  buildContext: "$(Build.SourcesDirectory)"
  tags: latest

steps:
  - script: echo building ${{ parameters.name }}
  - script: ls
  - task: Docker@2
    displayName: Login to DockerHub
    inputs:
      command: login
      containerRegistry: wallaskreaDockerHub
  - task: Docker@2
    displayName: Build and Push
    inputs:
      command: buildAndPush
      repository: wallaskrea/${{ parameters.name }} #wallaskrea/alpinemini #
      buildContext: ${{ parameters.buildContext }} #$(Build.SourcesDirectory)/Alpine #
      Dockerfile: ${{ parameters.dockerfile }} #${{ parameters.dockerfile }} #
      tags: |
        $(tags)
  - task: Docker@2
    displayName: Logout of DockerHub
    inputs:
      containerRegistry: wallaskreaDockerHub
      command: "logout"
# - template: azure_templates/buildDockerHubImages.yml # Template build&push dockerhub
#   param:
#     serviceDockerHub: ${{ variables.SERVICENAME_DOCKERHUB }}
#     repository: ${{ variables.DOCKERHUB_ACCOUNT }}/${{ job.ImageName }} #wallaskrea/alpinemini #
#     dockerfile: ${{ job.dockerfile }}
#     buildContext: ${{ job.buildContext }} #$(ALPINE_CONTEXT)
#     tags: ${{ job.tags }}
# - script: echo $(vmImage) -> finish ${{ job.name }}
# - ${{ each vmImage in ${{ variables.vmImages }} }}: # Each job
#   pool:
#     vmImage: $(vmImage)
#   steps:
#     - script: echo $(vmImage)-> building ${{ job.name }}
#     - template: azure_templates/buildDockerHubImages.yml # Template build&push dockerhub
#       param:
#         serviceDockerHub: ${{ variables.SERVICENAME_DOCKERHUB }}
#         repository: ${{ variables.DOCKERHUB_ACCOUNT }}/${{ job.ImageName }} #wallaskrea/alpinemini #
#         dockerfile: ${{ job.dockerfile }}
#         buildContext: ${{ job.buildContext }} #$(ALPINE_CONTEXT)
#         tags: ${{ job.tags }}
#     - script: echo $(vmImage) -> finish ${{ job.name }}
